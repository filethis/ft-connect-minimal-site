<!--
Copyright 2017 FileThis, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->


<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

        <title>ft-connect-minimal-site</title>
        <meta name="description" content="ft-connect-minimal-site description">

        <!-- Load any polyfills needed by the browser to support Web Components -->
        <script src="https://connect.filethis.com/webcomponents/webcomponentsjs/1.0.0/webcomponents-loader.js"></script>

        <style>

            /* Global */
            html, body {
                height: 100%;
                margin: 0;
                box-sizing: border-box;
                overflow:hidden;
            }
            *, *:before, *:after {
                box-sizing: inherit;
                overflow: inherit;
            }

            /* Local */
            .main {
                height: 100%;
                border-bottom: 1px solid black;
            }
            .fixture {
                height: 60px;
                border-bottom: 2px solid #DDD;
                padding-left: 20px;
                padding-right: 20px;
            }
            .title {
                font-family: Arial, Helvetica, sans-serif;
                font-size: 16pt;
            }
            .divider {
                width: 25px; height: 70%;
                border-left: 1px solid #EEE;
                margin-left: 20px;
            }
            .field-label {
                width: 125px;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 14px;
            }
            .field-entry {
                margin-left: 5px;
                font-family: Arial, Helvetica, sans-serif;
            }
            .content {
                padding: 20px;
            }
            .placeholder {
                box-shadow: 8px 8px 8px #CCC;
                width: 800px;
                height: 500px;
                border: 2px dashed black;
                padding: 10px 15px 10px 15px;
            }
            .wizard {
                box-shadow: 8px 8px 8px #CCC;
                width: 800px;
                height: 500px;
                border: 1px solid black;
            }
            .placeholder-title {
                color: #A9A9A9;
                font-family: Arial, Helvetica, sans-serif;
            }
            .instructions {
                margin-top: 15px;
                font-family: Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;
            }
            .button {
                margin-left: 18px;
            }
            .hidden {
                display: none !important;
            }

            /* Example of custom style mixin applied to FileThis sub-component */
            html {
                --ft-source-panel-heading:
                {
                    font-size:14pt;
                };
            }

            /* FlexBox */
            .layout.horizontal,
            .layout.vertical {
                display: -ms-flexbox;
                display: -webkit-flex;
                display: flex;
            }
            .layout.horizontal {
                -ms-flex-direction: row;
                -webkit-flex-direction: row;
                flex-direction: row;
            }
            .layout.vertical {
                -ms-flex-direction: column;
                -webkit-flex-direction: column;
                flex-direction: column;
            }
            .layout.center,
            .layout.center-center {
                -ms-flex-align: center;
                -webkit-align-items: center;
                align-items: center;
            }
            .layout.center-justified,
            .layout.center-center {
                -ms-flex-pack: center;
                -webkit-justify-content: center;
                justify-content: center;
            }
            .flex {
                -ms-flex: 1 1 0.000000001px;
                -webkit-flex: 1;
                flex: 1;
                -webkit-flex-basis: 0.000000001px;
                flex-basis: 0.000000001px;
            }
        </style>

    </head>

    <body>

        <!-- Import the FileThis drop-in "wizard" web component -->
        <link rel="import" href="https://connect.filethis.com/ft-connect-wizard/latest/dropin/ft-connect-wizard.html">

        <!-- Main panel with the fixture panel above the FileThis web component element -->
        <div class="main layout vertical">

            <!-- Fixture panel -->
            <div class="fixture layout horizontal center">

                <!-- Title -->
                <div class="title">
                    FileThisConnect Minimal Site
                </div>

                <!-- Guide button -->
                <button
                        id="guideButton"
                        class="button hidden"
                        type="button"
                        onclick="window.open('https://filethis.com/developer/front-end/ft-connect-minimal-site/'); return false;">
                    Guide
                </button>

                <!-- Divider -->
                <div class="divider"></div>

                <!-- Entry fields -->
                <div class="layout vertical">

                    <!-- FileThis User account id field -->
                    <div class="layout horizontal">
                        <div class="field-label">User Account ID:</div>
                        <input id="userAccountIdField" type="text" class="field-entry">
                    </div>

                    <!-- Spacer -->
                    <div style="height:6px;"></div>

                    <!-- FileThis User access token field -->
                    <div class="layout horizontal">
                        <div class="field-label">User Access Token:</div>
                        <input id="userAccessTokenField" type="password" class="field-entry">
                    </div>
                </div>

                <!-- Spacer -->
                <div class="flex"></div>

                <!-- Power button -->
                <button
                        id="powerButton"
                        class="button"
                        type="button"
                        onclick="onPowerButtonClicked()">
                    Turn On
                </button>
            </div>

            <!-- Center the wizard or placeholder elements in the content area -->
            <div class="content flex layout vertical center-center">

                <!-- Instance of the FileThis "wizard" web component element -->
                <ft-connect-wizard
                        id="wizard"
                        class="wizard hidden"
                        live="false"
                        user-account-id="XXXXX"
                        token="XXXXX"
                        debug="false"
                        fake-sources="true">
                </ft-connect-wizard>

                <!-- Placeholder with a dotted-outline that shows where the wizard element will go and contains some instructions -->
                <div
                        id="placeholder"
                        class="placeholder layout vertical center">

                    <!-- Title -->
                    <div class="placeholder-title">FileThis Web Component Element</div>

                    <!-- Instructions -->
                    <div class="instructions">
                        This is the "ft-connect-minimal-site" website.
                        It demonstrates how to embed an instance of the the "ft-connect-wizard" drop-in
                        web component element into a simple website
                    </div>
                    <div class="instructions">
                        Use the FileThis Front-End tool to create a user account and a temporary user access token using
                        your API key and secret, and then paste the account id and token string into the fields below.
                        Click the "Inject" button to inject these into the component instance. Then play.
                    </div>
                    <div style="margin-bottom:15px;">In a real app, your backend...</div>

                    <!-- Show source button -->
                    <button
                            type="button"
                            onclick="window.open('https://github.com/filethis/ft-connect-minimal-site/blob/master/index.html'); return false;">
                        Show Source
                    </button>
                </div>
            </div>
        </div>

        <script>

            function onPowerButtonClicked()
            {
                if (isOn())
                    turnOff();
                else // is off
                    turnOn();
            }

            function turnOn()
            {
                // window.alert = function() {
                //     debugger;
                // };

                var wizard = document.getElementById("wizard");
                var placeholder = document.getElementById("placeholder");
                
                addEventListentersTo(wizard);

                // Get values entered by the user
                var userAccountId = document.getElementById("userAccountIdField").value;
                var userAccessToken = document.getElementById("userAccessTokenField").value;

                // Validate the values
                if (!parseInt(userAccountId))
                {
                    alert("Please enter a valid FileThis user account ID.");
                    return;
                }
                if (userAccessToken.length === 0)
                {
                    alert("Please enter a valid, unexpired FileThis user access token.");
                    return;
                }

                // Show the wizard
                show(wizard);
                hide(placeholder);

                // Inject values into the wizard and turn it on
                wizard.userAccountId = userAccountId;
                wizard.token = userAccessToken;
                wizard.live = true;

                // Toggle the power button label
                var powerButton = document.getElementById("powerButton");
                powerButton.innerText = "Turn Off";
            }

            function turnOff()
            {
                var wizard = document.getElementById("wizard");
                var placeholder = document.getElementById("placeholder");
                
                removeEventListenersFrom(wizard);

                // Hide the wizard
                hide(wizard);
                show(placeholder);

                // Turn off the wizard
                wizard.live = false;

                // Toggle the power button label
                var powerButton = document.getElementById("powerButton");
                powerButton.innerText = "Turn On";
            }

            function isOn()
            {
                var powerButton = document.getElementById("powerButton");
                return (powerButton.innerText === "Turn Off");
            }
            
            function addEventListentersTo(wizard)
            {
                wizard.addEventListener('ft-connect-error', onWizardError);
                wizard.addEventListener('wizard-canceled-command', onWizardCanceledCommand);
                wizard.addEventListener('wizard-done-command', onWizardDoneCommand);
            }
            
            function removeEventListenersFrom(wizard)
            {
                wizard.removeEventListener('wizard-done-command', onWizardDoneCommand);
                wizard.removeEventListener('wizard-canceled-command', onWizardCanceledCommand);
                wizard.removeEventListener('ft-connect-error', onWizardError);
            }
            
            function show(element)
            {
                element.classList.remove("hidden");
            }

            function hide(element)
            {
                element.classList.add("hidden");
            }

            function onWizardError(event)
            {
                turnOff();

                alert(event.detail);
            }

            function onWizardCanceledCommand(event)
            {
                alert("When the user clicks the \"Cancel\" button, your \"wizard-canceled-command\" event handler should do the appropriate thing in your workflow.");
            }

            function onWizardDoneCommand(event)
            {
                alert("When the user clicks the \"Done\" button, your \"wizard-done-command\" event handler should do the appropriate thing in your workflow.");
            }

        </script>
    </body>
</html>
