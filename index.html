<!--
Copyright 2018 FileThis, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!doctype html>
<html lang="en">

    <head>

        <!-- Boilerplate -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1, user-scalable=yes">

        <!-- Window title and description -->
        <title>ft-connect-minimal-site</title>
        <meta name="description" content="ft-connect-minimal-site description">

        <!-- Load any polyfills needed by the user's browser to support Web Components -->
        <script src="https://connect.filethis.com/webcomponents/webcomponentsjs/1.0.0/webcomponents-loader.js"></script>

        <style>

            /* Global */
            html, body {
                height: 100%;
                margin: 0;
                box-sizing: border-box;
                overflow: hidden;
            }
            *, *:before, *:after {
                box-sizing: inherit;
                overflow: inherit;
            }

            /* Local */
            .main {
                height: 100%;
                background-color: #FAFAFA;
                border-bottom: 1px solid black;
            }
            .fixture {
                height: 60px;
                border-bottom: 2px solid #DDD;
                padding-left: 20px;
                padding-right: 20px;
                background-color: white;
            }
            .title {
                font-family: Arial, Helvetica, sans-serif;
                font-size: 16pt;
            }
            .divider {
                width: 22px; height: 70%;
                border-left: 1px solid #EEE;
                margin-left: 20px;
            }
            .field-label {
                width: 125px;
                font-family: Arial, Helvetica, sans-serif;
                font-size: 14px;
            }
            .field-entry {
                margin-left: 5px;
                font-family: Arial, Helvetica, sans-serif;
            }
            .content {
                padding: 20px;
            }
            .placeholder {
                box-shadow: 8px 8px 8px #CCC;
                width: 800px;
                height: 500px;
                border: 2px dashed black;
                padding: 10px 15px 10px 15px;
                background-color: white;
            }
            .wizard {
                box-shadow: 8px 8px 8px #CCC;
                width: 800px;
                height: 500px;
                border: 1px solid black;
            }
            .placeholder-title {
                color: #A9A9A9;
                font-family: Arial, Helvetica, sans-serif;
                margin-bottom: 15px;
            }
            p {
                font-family: Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;
            }
            .button {
                margin-left: 18px;
            }
            .button-stacked {
                width: 80px;
            }
            .hidden {
                display: none !important;
            }

            /* Example of applying a custom style mixin to a FileThis sub-component */
            html {
                --ft-source-panel-heading:
                {
                    font-size:14pt;
                };
            }

            /* FlexBox */
            .layout.horizontal,
            .layout.vertical {
                display: -ms-flexbox;
                display: -webkit-flex;
                display: flex;
            }
            .layout.horizontal {
                -ms-flex-direction: row;
                -webkit-flex-direction: row;
                flex-direction: row;
            }
            .layout.vertical {
                -ms-flex-direction: column;
                -webkit-flex-direction: column;
                flex-direction: column;
            }
            .layout.center,
            .layout.center-center {
                -ms-flex-align: center;
                -webkit-align-items: center;
                align-items: center;
            }
            .layout.center-center {
                -ms-flex-pack: center;
                -webkit-justify-content: center;
                justify-content: center;
            }
            .flex {
                -ms-flex: 1 1 0.000000001px;
                -webkit-flex: 1;
                flex: 1;
                -webkit-flex-basis: 0.000000001px;
                flex-basis: 0.000000001px;
            }
        </style>
    </head>

    <body>

        <!-- Import drop-in copy of the ft-connect-wizard Web Component from FileThis CDN -->
        <link rel="import" href="https://connect.filethis.com/ft-connect-wizard/latest/dropin/ft-connect-wizard.html">
                                                    <!-- or -->
        <!-- Import local copy of the ft-connect-wizard Web Component. (Execute "make bower-install-packages" first.) -->
        <!--<link rel="import" href="bower_components/ft-connect-wizard/ft-connect-wizard.html">-->

        <!-- Main panel with the fixture panel above the FileThis Web Component element -->
        <div class="main layout vertical">

            <!-- Fixture panel -->
            <div class="fixture layout horizontal center">

                <!-- Title -->
                <div class="title">
                    FileThisConnect Minimal Site
                </div>

                <!-- Guide button -->
                <button
                        id="guideButton"
                        class="button"
                        type="button"
                        onclick="window.open('https://filethis.com/developer/front-end/ft-connect-minimal-site/'); return false;">
                    Guide
                </button>

                <!-- Vertical dividing line -->
                <div class="divider"></div>

                <!-- Entry fields -->
                <div class="layout vertical">

                    <!-- FileThis User account id field -->
                    <div class="layout horizontal">
                        <div class="field-label">User Account ID:</div>
                        <input
                            id="userAccountIdField"
                            class="field-entry"
                            type="text"
                            onkeyup="saveSettings()"
                        >
                    </div>

                    <!-- FileThis User access token field -->
                    <div class="layout horizontal" style="margin-top:6px;">
                        <div class="field-label">User Access Token:</div>
                        <input
                            id="userAccessTokenField"
                            class="field-entry"
                            type="password"
                            onkeyup="saveSettings()"
                        >
                    </div>
                </div>

                <!-- Vertical dividing line -->
                <div class="divider"></div>

                <!-- SDK Tool and Source buttons -->
                <div class="layout vertical center">

                    <!-- SDK Tool button -->
                    <button
                        type="button"
                        class="button-stacked"
                        onclick="window.open('https://connect.filethis.com/ft-connect-front-end-sdk-tool/latest/app/index.html'); return false;"
                    >
                        SDK Tool
                    </button>

                    <!-- Show source button -->
                    <button
                        type="button"
                        class="button-stacked"
                        style="margin-top:6px;"
                        onclick="window.open('https://github.com/filethis/ft-connect-minimal-site/blob/master/index.html'); return false;"
                    >
                        Source
                    </button>

                </div>

                <!-- Spacer -->
                <div class="flex"></div>

                <!-- Power button -->
                <button
                    id="powerButton"
                    class="button"
                    type="button"
                    onclick="onPowerButtonClicked()"
                >
                    Turn On
                </button>
            </div>

            <!-- Center the wizard and placeholder elements within the content area. Only one is visible at a time. -->
            <div class="content flex layout vertical center-center">

                <!-- Instance of the FileThis "wizard" Web Component element -->
                <!-- ******************************************************* -->
                <ft-connect-wizard
                    id="wizard"
                    class="wizard hidden"
                    live="false"
                    user-account-id="XXXXX"
                    token="XXXXX"
                    debug="false"
                    fake-sources="true"
                >
                </ft-connect-wizard>
                <!-- ******************************************************* -->

                <!-- Placeholder with a dotted-outline that shows where the wizard will go and contains instructions -->
                <div
                    id="placeholder"
                    class="placeholder layout vertical"
                >
                    <!-- Title -->
                    <div class="layout vertical center">
                        <div class="placeholder-title">&lt;ft-connect-wizard&gt;</div>
                    </div>

                    <!-- Instructions -->
                    <p>
                        Welcome to the FileThisConnect minimal website.
                    </p>

                    <p>
                        This is a website which embeds an instance of the <i>ft-connect-wizard</i> Web Component
                        element. In order to highlight the ease and simplicity of embedding this component, we made the
                        code that surrounds it as simple as possible. To view the single source code file that
                        implements this site, you can either use your browser's <i>View Page Source</i> command,
                        or click the <i>Source</i> button above to visit our GitHub repository.
                    </p>

                    <p>
                        This header at the top of this page lets you enter the FileThis user account ID and access token
                        that are needed to bring the component to life. In an actual integration of your system and ours,
                        you'll add code to your backend to request these from our service and then convey them to your own
                        front end by the appropriate means.
                    </p>

                    <p>
                        To obtain a FileThis user account ID and access token for use by this page, click the <i>SDK Tool</i>
                        button above to visit the <i>FileThisConnect Front-End SDK Tool</i> webapp, and create them
                        there using your FileThis API key and secret. After youâ€™ve pasted the two
                        strings into the fields in the header above, click the <i>Turn On</i> button at the
                        upper right-hand corner of this window to inject them into the component. You'll see the live
                        component replace the box that contains these instructions.
                    </p>
                </div>
            </div>
        </div>

        <script>

            // Startup
            (function()
            {
               loadSettings();
            })();

            function onPowerButtonClicked()
            {
                if (isOn())
                    turnOff();
                else // is off
                    turnOn();
            }

            function turnOn()
            {
                var wizard = document.getElementById("wizard");
                var placeholder = document.getElementById("placeholder");
                
                addEventListentersTo(wizard);

                // Get values entered by the user
                var userAccountId = document.getElementById("userAccountIdField").value;
                var userAccessToken = document.getElementById("userAccessTokenField").value;

                // Validate the values
                if (!parseInt(userAccountId))
                {
                    alert("Please enter a valid FileThis user account ID.");
                    return;
                }
                if (userAccessToken.length === 0)
                {
                    alert("Please enter a valid, unexpired FileThis user access token.");
                    return;
                }

                // Show the wizard
                show(wizard);
                hide(placeholder);

                // Inject values into the wizard and turn it on
                wizard.userAccountId = userAccountId;
                wizard.token = userAccessToken;
                wizard.live = true;

                // Toggle the power button label
                var powerButton = document.getElementById("powerButton");
                powerButton.innerText = "Turn Off";
            }

            function turnOff()
            {
                var wizard = document.getElementById("wizard");
                var placeholder = document.getElementById("placeholder");
                
                removeEventListenersFrom(wizard);

                // Hide the wizard
                hide(wizard);
                show(placeholder);

                // Turn off the wizard
                wizard.live = false;

                // Toggle the power button label
                var powerButton = document.getElementById("powerButton");
                powerButton.innerText = "Turn On";
            }

            function isOn()
            {
                var powerButton = document.getElementById("powerButton");
                return (powerButton.innerText === "Turn Off");
            }
            
            function addEventListentersTo(wizard)
            {
                wizard.addEventListener('ft-connect-error', onWizardError);
                wizard.addEventListener('wizard-canceled-command', onWizardCanceledCommand);
                wizard.addEventListener('wizard-done-command', onWizardDoneCommand);
            }
            
            function removeEventListenersFrom(wizard)
            {
                wizard.removeEventListener('wizard-done-command', onWizardDoneCommand);
                wizard.removeEventListener('wizard-canceled-command', onWizardCanceledCommand);
                wizard.removeEventListener('ft-connect-error', onWizardError);
            }
            
            function show(element)
            {
                element.classList.remove("hidden");
            }

            function hide(element)
            {
                element.classList.add("hidden");
            }

            function onWizardCanceledCommand(event)
            {
                alert("When the user clicks the \"Cancel\" button, your \"wizard-canceled-command\" event handler should do the appropriate thing in your workflow.");
            }

            function onWizardDoneCommand(event)
            {
                alert("When the user clicks the \"Done\" button, your \"wizard-done-command\" event handler should do the appropriate thing in your workflow.");
            }

            function loadSettings()
            {
                if (localStorage.settings)
                {
                    var settings = JSON.parse(localStorage.settings);
                    document.getElementById("userAccountIdField").value = settings.userAccountId;
                    document.getElementById("userAccessTokenField").value = settings.userAccessToken;
                }
            }

            function saveSettings()
            {
                var userAccountId = document.getElementById("userAccountIdField").value;
                var userAccessToken = document.getElementById("userAccessTokenField").value;
                var settings = { userAccountId: userAccountId, userAccessToken: userAccessToken };
                localStorage.settings = JSON.stringify(settings);
            }

            function onWizardError(event)
            {
                turnOff();

                alert(getErrorMessageFrom(event));
            }

            function getErrorMessageFrom(event)
            {
                var detail = event.detail;
                if (!detail)
                    return "Error";
                var response = detail.response;
                if (!response)
                    return detail;
                var status = response.status;
                if (!status)
                    return detail;
                if (status === 400)
                    return "The current FileThis user access token expired.\n\nClick the \"SDK Tool\" button to create a new one and paste it into the field on this page.";
                var message = response.message;
                if (!message)
                    return detail;
                return message;
            }

        </script>
    </body>
</html>
